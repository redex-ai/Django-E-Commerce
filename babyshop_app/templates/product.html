{% extends 'partoftemp/_dashboard.html' %}
{% block content %}

<div class="col-md-12 mt-4">
  <div class="row g-0 border rounded overflow-hidden flex-md-row mb-4 shadow-sm h-md-250 position-relative">
    <div class="col p-4 d-flex flex-column position-static">
      <h3 class="mb-0">{{ product.name }}</h3>
      <div class="mb-1 text-muted">{{ product.price }} &#8378;</div>
      <p class="card-text mb-auto">{{ product.description }}</p>
      <div class="btn btn-primary btn-center">Satın Al</div>
    </div>
    <div class="col-auto d-none d-lg-block">
      <img src="{{ product.image.url }}" width="400" height="400" alt="">
    </div>
  </div>
</div>

<!-- Display existing reviews -->
<div class="product-reviews">
  <h4>Product Reviews</h4>
  {% for review in product.reviews.all %}
  <div class="review">
    <strong>{{ review.user.username }}</strong> - <em>{{ review.rating }}/5</em>
    <p>{{ review.comment }}</p>
  </div>
  {% empty %}
  <p>No reviews yet.</p>
  {% endfor %}
</div>

<!-- Review form -->
<div class="review-form">
  <h4>Add a Review</h4>
  <form method="post" action="{% url 'add_review' product.id %}">
    {% csrf_token %}
    <div class="form-group">
      <label for="rating">Rating</label>
      <input type="number" id="rating" name="rating" min="1" max="5" required>
    </div>
    <div class="form-group">
      <label for="comment">Comment</label>
      <textarea id="comment" name="comment" rows="4" required></textarea>
    </div>
    <button type="submit" class="btn btn-primary">Submit Review</button>
  </form>
</div>

<div class="row">
  {% for product in products %}
  <div class="card" style="width: 18rem;">
    <img src="{{ product.image.url }}" class="card-img-top" width="300" height="230">
    <div class="card-body">
      <h5 class="card-title"><a href="{% url 'product_detail' product.category.slug product.id %}">{{ product.name }}</a></h5>
      <div class="mb-1 text-muted">{{ product.price }} &#8378;</div>
      <p class="card-text">{{ product.description | truncatechars:80 }}</p>
      <a href="{% url 'product_detail' product.category.slug product.id %}" class="btn btn-primary">Detayına Git</a>
    </div>
  </div>
  {% endfor %}
</div>

{% endblock %}
